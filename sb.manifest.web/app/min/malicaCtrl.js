"use strict";var app=angular.module("SbManifest");app.controller("malicaCtrl",(function($scope,$state,$filter,apiService,config){$scope.fromDate=$state.params.from,$scope.toDate=$state.params.to,$scope.monthFormat=buildLocaleProvider("MMM YYYY"),$scope.alertFromDate=!1,$scope.alertToDate=!1,$scope.malica=$state.params.malica,$scope.racun=$state.params.racun,$scope.myPage=$state.params.page,$scope.myLimit=$state.params.limit,$scope.myOrder=$state.params.order,$scope.query={order:"name",limit:5,page:1},$scope.rows=$state.params.rows,$scope.getMalica=function(){$scope.myPage=1;var fd=new Date($scope.fromDate),td=new Date($scope.toDate);if($scope.fromDate>$scope.toDate)var fd=new Date($scope.toDate),td=new Date($scope.fromDate);var url=config.hrDocApi+"/api/malica/",params={aFromDate:fd.setMonth(fd.getMonth()),bToDate:td.setMonth(td.getMonth()+1)};apiService.getData(url,params,!0).then((function(data){$scope.malica=data.DataList[0],$scope.rows=data.RowsCount}))},$scope.getRacun=function(p){if(0!=p.Racun){var rac=$filter("filter")($scope.malica.Racuni,{Racun:p.Racun}),racun=$filter("filter")($scope.malica.Racuni,{Id:rac[0].Id});$state.go("racunm",{from:$scope.fromDate,to:$scope.toDate,list:$scope.list,racun:racun,malica:$scope.malica,rows:$scope.rows,page:$scope.myPage,limit:$scope.myLimit,order:$scope.myOrder}),$("html, body").animate({scrollTop:0},"fast")}},$scope.dateChanged=function(){$scope.alertFromDate=!1,$scope.alertToDate=!1,null==$scope.fromDate&&($scope.alertFromDate=!0),null==$scope.toDate&&($scope.alertToDate=!0),$scope.fromDate&&$scope.toDate&&$scope.getMalica()},$scope.showTransakcije=function(){$state.go("malica",{from:$scope.fromDate,to:$scope.toDate,malica:$scope.malica,rows:$scope.rows,page:$scope.myPage,limit:$scope.myLimit,order:$scope.myOrder})},$scope.getRacunCss=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"racunMobileCss":"racunCss"},$scope.init=function(){$state.params.malica||$scope.getMalica()},window.addEventListener("popstate",(function(event){"racunMalica"==$state.current.name&&(window.history.pushState(null,"",window.location.href),$scope.showMalica())}),!1)}));