"use strict";var app=angular.module("SbManifest");app.controller("customerCtrl",(function($scope,$state,$mdDialog,apiService,config){$scope.list=$state.params.list,$scope.query=$state.params.query,$scope.rows=$state.params.rows,$scope.getCustomerList=function(){var url=config.manifestApi+"/customer/list";$scope.query.asc=!$scope.query.asc;var params={search:$scope.search,pageIndex:$scope.query.page,pageSizeSelected:$scope.query.limit,sortKey:$scope.query.order,asc:$scope.query.asc};$scope.promise=apiService.getData(url,params,!0).then((function(data){$scope.list=data.DataList,$scope.rows=data.RowsCount}))},$scope.getInvoice=function($event,dto){$mdDialog.show({locals:{dataToPass:dto},controller:"invoiceCtrl",controllerAs:"ctrl",templateUrl:"app/components/shop/invoice.html",parent:angular.element(document.body),targetEvent:$event,clickOutsideToClose:!1}).then((function(){$scope.getCustomerList()})).catch((function(){}))},$scope.purchase=function($event,dto){dto.IdCustomer=dto.Id,$mdDialog.show({locals:{dataToPass:dto},controller:"purchaseCtrl",controllerAs:"ctrl",templateUrl:"app/components/shop/purchase.html",parent:angular.element(document.body),targetEvent:$event,clickOutsideToClose:!1}).then((function(){})).catch((function(){}))},$scope.editCustomer=function($event,dto){$mdDialog.show({locals:{dataToPass:dto},controller:"editCustomerCtrl",controllerAs:"ctrl",templateUrl:"app/components/customers/editCustomer.html",parent:angular.element(document.body),targetEvent:$event,clickOutsideToClose:!1}).then((function(){$scope.getCustomerList()})).catch((function(){}))},$scope.onKeyPressSearch=function($event){13===$event.charCode&&$scope.getCustomerList()},$scope.detailsCustomer=function(dto){$state.go("detailsCustomer",{dto:dto,list:$scope.list,query:$scope.query,rows:$scope.rows})},$scope.init=function(){$scope.getCustomerList()}})),app.controller("editCustomerCtrl",(function($scope,$mdDialog,dataToPass,apiService,config){var self=this;$scope.warning=null,$scope.customer=dataToPass,$scope.label=null==$scope.customer?"Add new customer":$scope.customer.Name,$scope.countries,$scope.customer.BirthDate=null==$scope.customer.BirthDate?new Date(1950,0,1):$scope.customer.BirthDate,this.cancel=function($event){$mdDialog.cancel()},this.save=function($event){$scope.customer.BirthDate=convertLocalDate($scope.customer.BirthDate);var url=config.manifestApi+"/customer/save";apiService.postData(url,$scope.customer,!0).then((function(){$mdDialog.hide()}))},$scope.getCountries=function(){var url=config.manifestApi+"/settings/countries",promise;return apiService.getData(url,null,!1).then((function(data){$scope.countries=data.DataList}))},$scope.setCountry=function(dto){$scope.countries=[{Id:dto.IdCountry,Name:dto.Country}]}})),app.controller("detailsCustomerCtrl",(function($scope,$state,$mdDialog,apiService,config){$scope.pList=$state.params.list,$scope.pQuery=$state.params.query,$scope.pRows=$state.params.rows,$scope.dto=$state.params.dto,$scope.query={order:"",limit:5,page:1,filter:"",asc:!1},$scope.rows,$scope.getTicketPostList=function(){var url=config.manifestApi+"/customer/ticketpost/list";$scope.query.asc=!$scope.query.asc;var params={search:$scope.search,idCustomer:$scope.dto.Id,pageIndex:$scope.query.page,pageSizeSelected:$scope.query.limit,sortKey:$scope.query.order,asc:$scope.query.asc};$scope.promise=apiService.getData(url,params,!0).then((function(data){$scope.tickets=data.DataList,$scope.rows=data.RowsCount}))},$scope.getLoadList=function(){var url=config.manifestApi+"/customer/load/list";$scope.query.asc=!$scope.query.asc;var params={search:$scope.search,idCustomer:$scope.dto.Id,pageIndex:$scope.query.page,pageSizeSelected:$scope.query.limit,sortKey:$scope.query.order,asc:$scope.query.asc};$scope.promise=apiService.getData(url,params,!0).then((function(data){$scope.jumps=data.DataList,$scope.rows=data.RowsCount}))},$scope.onKeyPressSearch=function($event){13===$event.charCode&&$scope.getTicketPostList()},$scope.purchase=function($event){$scope.dto.IdCustomer=$scope.dto.Id,$mdDialog.show({locals:{dataToPass:$scope.dto},controller:"purchaseCtrl",controllerAs:"ctrl",templateUrl:"app/components/shop/purchase.html",parent:angular.element(document.body),targetEvent:$event,clickOutsideToClose:!1}).then((function(){})).catch((function(){}))},$scope.init=function(){$scope.getLoadList()},$scope.back=function(){$state.go("customers",{list:$scope.pList,rows:$scope.pRows,query:$scope.pQuery})}}));