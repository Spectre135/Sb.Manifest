"use strict";var app=angular.module("SbManifest");app.controller("dduCtrl",(function($scope,$filter,apiService,config){$scope.obdobje,$scope.monthFormat=buildLocaleProvider("MMM YYYY"),$scope.maxDate=new Date,$scope.data,$scope.employee,$scope.calendar,$scope.salary,$scope.working1=!1,$scope.working2=!1,$scope.working3=!1,$scope.working4=!1,$scope.getData=function(){$scope.working1=!0,$scope.working2=!0,$scope.working3=!0,$scope.working4=!0,$scope.obdobje=addDays($scope.obdobje,1);var url=config.hrDocApi+"/api/ddu/employee/",params={aFromDate:$scope.obdobje};apiService.getData(url,params,!1).then((function(data){$scope.employee=data.DataList[0],$scope.working1=!1,$scope.getCalendar()})).catch((function onError(){$scope.working1=!1,$scope.working2=!1,$scope.working3=!1,$scope.working4=!1}))},$scope.getCalendar=function(){$scope.working2=!0;var url=config.hrDocApi+"/api/ddu/calendar/",params={aFromDate:$scope.obdobje};apiService.getData(url,params).then((function(data){$scope.calendar=data.DataList,$scope.getEmployeeCalendar(),$scope.working2=!1})).catch((function onError(){$scope.working2=!1,$scope.working3=!1,$scope.working4=!1}))},$scope.getEmployeeCalendar=function(){$scope.working3=!0;var url=config.hrDocApi+"/api/ddu/employee/calendar/",params={aFromDate:$scope.obdobje};apiService.getData(url,params).then((function(data){$scope.data=data.DataList,$scope.working3=!1,$scope.getSalary()})).catch((function onError(){$scope.working3=!1,$scope.working4=!1}))},$scope.getSalary=function(){$scope.working4=!0;var url=config.hrDocApi+"/api/ddu/salary/",params={aFromDate:$scope.obdobje};apiService.getData(url,params).then((function(data){$scope.salary=data.DataList,$scope.working4=!1})).catch((function onError(){$scope.working4=!1}))},$scope.dateChanged=function(){$scope.getData()},$scope.isHolidayClass=function(dto){try{if("T"==dto.IsHoliday||0==new Date(dto.DayDate).getDay())return"ddu_calendar_isHoliday"}catch(error){}},$scope.calcSumValues=function(dto){try{var num=0,isMinutes,array=$filter("filter")($scope.data,{ValueItemCode:dto.ValueItemCode}),hours,minutes;return angular.forEach(array,(function(value,key){"T"==value.MeasureInMinutes&&(isMinutes=!0,num+=value.ValueItemValue),"F"==value.MeasureInMinutes&&(isMinutes=!1,num+=value.ValueItemValue)})),isMinutes?Math.floor(num/60)+":"+pad(num%60,2):num}catch(error){return console.log(error),0}},$scope.getTotalHours=function(){try{var plusHours=Math.floor($scope.diff($scope.employee.PlusMinusMinutesEnd,$scope.employee.PlusMinusMinutesStart)/60),fundHours;return $scope.employee.FundHoursInPeriod+plusHours}catch(error){}},$scope.sum=function(val1,val2){try{return val1+val2}catch(error){return val1}},$scope.diff=function(val1,val2){try{return val1-val2}catch(error){return val1}}}));