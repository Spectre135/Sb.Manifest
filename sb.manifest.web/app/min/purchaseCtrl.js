"use strict";var app=angular.module("SbManifest");app.controller("purchaseCtrl",(function($scope,$filter,$mdDialog,dataToPass,apiService,config){var self=this;function getProductsSlot(){var url=config.manifestApi+"/settings/sales/product/slot",promise;return apiService.getData(url,null,!0).then((function(data){$scope.productList=$filter("filter")(data.DataList,(function(item){return 0==item.IsStaffJob&&item.Income>0})),getProducts()}))}function getProducts(){var url=config.manifestApi+"/settings/sales/product",promise;return apiService.getData(url,null,!0).then((function(data){$scope.productList=$scope.productList.concat($filter("filter")(data.DataList,(function(item){return 0==item.IsProductSlot}))),getPayMethod()}))}function getPayMethod(){var url=config.manifestApi+"/settings/paymethod",promise;return apiService.getData(url,null,!0).then((function(data){$scope.payMethodList=data.DataList}))}$scope.working=!1,$scope.dto=dataToPass,$scope.dto.IdPayMethod=1,$scope.dto.Quantity=1,this.save=function($event){var url=config.manifestApi+"/post/shop/buy";apiService.postData(url,$scope.dto,!0).then((function(){$mdDialog.hide()}))},this.cancel=function($event){$mdDialog.cancel()},$scope.init=function(){getProductsSlot()},$scope.sum=function(){try{var array=$filter("filter")($scope.productList,(function(item){return item.Id==$scope.dto.IdProduct}));$scope.dto.Price=array[0].Income*$scope.dto.Quantity,$scope.dto.Details=array[0].Name+" "+array[0].Description}catch(error){}}}));