"use strict";var app=angular.module("SbManifest");app.controller("payrollCtrl",(function($scope,$state,$window,apiService,config){$scope.fromDate=$state.params.from,$scope.toDate=$state.params.to,$scope.monthFormat=buildLocaleProvider("MMM YYYY"),$scope.minDateTo=new Date(2019,12,31),$scope.minDateFrom=new Date(2019,12,31),$scope.alertFromDate=!1,$scope.alertToDate=!1,$scope.data=$state.params.data,$scope.list=$state.params.list,$scope.myPage=$state.params.page,$scope.myLimit=$state.params.limit,$scope.myOrder=$state.params.order,$scope.query={order:"name",limit:5,page:1},$scope.rows=$state.params.rows,$scope.getPayroll=function(p){var url=config.hrDocApi+"/api/payroll/";apiService.postData(url,p,!0).then((function(data){$state.go("payroll",{from:$scope.fromDate,to:$scope.toDate,data:data,list:$scope.list,rows:$scope.rows,page:$scope.myPage,limit:$scope.myLimit,order:$scope.myOrder}),$("html, body").animate({scrollTop:0},"fast")}))},$scope.getPayrollList=function(){$scope.myPage=1;var fd=new Date($scope.fromDate),td=new Date($scope.toDate);if($scope.fromDate>$scope.toDate)var fd=new Date($scope.toDate),td=new Date($scope.fromDate);var url=config.hrDocApi+"/api/payroll/list",params={aFromDate:fd.setMonth(fd.getMonth()),bToDate:td.setMonth(td.getMonth()+1)};apiService.getData(url,params,!0).then((function(data){$scope.list=data.DataList,$scope.rows=data.RowsCount}))},$scope.print=function(){var contents=document.getElementById("payrollList").innerHTML,body=document.getElementsByTagName("BODY")[0],frame1=document.createElement("IFRAME");frame1.name="frame1",body.appendChild(frame1);var frameDoc=frame1.contentWindow?frame1.contentWindow:frame1.contentDocument.document?frame1.contentDocument.document:frame1.contentDocument;frameDoc.document.open(),frameDoc.document.write("<html>"),frameDoc.document.write('<body style="font-size:14px;line-height:.7;"><div style="padding-left:25px;">'),frameDoc.document.write(contents),frameDoc.document.write("</div></body></html>"),frameDoc.document.close(),$window.setTimeout((function(){$window.frames.frame1.focus(),$window.frames.frame1.print(),body.removeChild(frame1)}),500)},$scope.showList=function(){$state.go("payrollist",{from:$scope.fromDate,to:$scope.toDate,list:$scope.list,rows:$scope.rows,page:$scope.myPage,limit:$scope.myLimit,order:$scope.myOrder})},$scope.dateChanged=function(){$scope.alertFromDate=!1,$scope.alertToDate=!1,null==$scope.fromDate&&($scope.alertFromDate=!0),null==$scope.toDate&&($scope.alertToDate=!0),$scope.fromDate&&$scope.toDate&&$scope.getPayrollList()},$scope.getPayrollCss=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"payrollMobileCss":"payroll"},$scope.init=function(){$state.params.list||$scope.getPayrollList()},window.addEventListener("popstate",(function(event){"payrollist"==$state.current.name&&(window.history.pushState(null,"",window.location.href),$scope.showList())}),!1)}));