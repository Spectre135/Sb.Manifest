"use strict";var app=angular.module("SbManifest");app.controller("displayCtrl",(function($scope,$interval,config,apiService){$scope.loads,$scope.connected=!1,$scope.showLoadList=!0,$scope.showPic=!1,$scope.pic="pictures/1.jpg";const displayTime=6e4,picTime=5e3;let refresh=6e4;function swap(){$scope.$apply((function(){$scope.showPic=!$scope.showPic,$scope.showLoadList=!$scope.showLoadList})),$scope.showPic?(refresh=5e3,setTimeout(swap,refresh)):(refresh=6e4,setTimeout(swap,refresh))}function getLoadList(){var params={},url=config.manifestApi+"/load/list",promise;return apiService.getData(url,params,!0).then((function(data){$scope.loads=data.DataList}))}$scope.helpOpacity=1,document.body.onkeydown=function(e){BodyOnKeyDown(e)},setTimeout(fadeHelp,1e4),setTimeout(swap,refresh);var connection=(new signalR.HubConnectionBuilder).configureLogging(signalR.LogLevel.Debug).withUrl(config.displayHub,{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets,accessTokenFactory:()=>sessionStorage.getItem("Authorization")}).build();function fadeHelp(){if($scope.helpOpacity>0){$scope.helpOpacity=Math.max($scope.helpOpacity-.01,0);const helpBtn=angular.element("#help-btn")[0];helpBtn.style.opacity=$scope.helpOpacity,setTimeout(fadeHelp,100)}}function BodyOnKeyDown(e){if([68,70,72,52,100,53,101,54,102,107,109,187,189].includes(e.which)){const html=angular.element("html")[0];let fontSize=new Number(html.style.fontSize.replace("%",""));if(68==e.which)fontSize=6.25;else if(70==e.which)document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen();else if(72==e.which){const help=angular.element("#help");help.toggleClass("open")}else if([107,187].includes(e.which))fontSize+=.1;else if([109,189].includes(e.which))fontSize-=.1;else if([52,100,53,101,54,102].includes(e.which)){let cols=0;[52,100].includes(e.which)?cols=4:[53,101].includes(e.which)?cols=5:[54,102].includes(e.which)&&(cols=6),fontSize=6.25*document.body.clientWidth/(280*cols+8)}html.style.fontSize=fontSize+"%"}}connection.start().then((function(){$scope.connected=!0})).catch((function(err){console.log(err)})),connection.on("messageReceived",(function(data){$scope.$apply((function(){$scope.loads=data.DataList}))})),$scope.getGroupClass=function(group){return"group g"+(group||0)},$scope.toggleHelp=function(){const help=angular.element("#help");help.toggleClass("open")},$scope.init=function(){getLoadList()}}));